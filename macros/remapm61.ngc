; M61 REMAP Macro for ATC tool change
;
; Assumptions
; Toolnumber is not equal to pocket number
; pocket number  is the discriminating factor for pick up procedure (from rack, from manual position)

; Uses global numbered variabel e#5190 to store the pocket of the tool that gets mounted as a work aorund for the broken handler 

; M61 is used to specify the tool in the spindle. Not sure if any of tool-in-spindle, current_pocket, selected_tool and selected_pocket are active at all

o<remapm61> sub
;(auto-restore modal settings on return)
; M73 
; see MCOde Documentation for testing this
; print to console (if available)
(print, in change tool_in_spindle=#<tool_in_spindle> current_pocket=#<current_pocket>)
(print, selected_tool=#<selected_tool> selected_pocket=#<selected_pocket>)
(print, selected_tool=#<tool> selected_pocket=#<pocket>)

(print, prep-pocket #<_hal[iocontrol.0.tool-prep-pocket]>)

;#5190=#<_hal[iocontrol.0.tool-prep-pocket]>

M61


o<remapm61> endsub [1]
M2